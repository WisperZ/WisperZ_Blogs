# C语言编码规范 (V1.0.0)
**注** : 本文主要阐述具体的编码规范, 目录、前言、简介等暂时未列出, 本文只约束了部分编码规范内容, 如有未约束到的按照约定俗成的规范进行操作

---

## 术语定义
**规则:** 编程时必须遵循的条约
**议建:** 编程时建议遵循的条约
**说明:** 对 规则/建议 做必要的解释
**示例:** 对 规则/建议 给出的例子

---

## 1. 通用格式

- 这里列出了最明显和最重要的一般规则
- 始终尊重项目或库中已经使用的代码风格, 使用外部提供的文件不应修改它们原有的编码规则
### 1.1 建议 通用建议

- 每行不得超过120个字符
- 每个文件不得超过1500行
- 每个函数不得超过50行
- 行尾不能出现多余空格
- 头文件中适合放置接口的声明, 不适合放置实现
- 禁止在`.c`中通过`extern`的方式使用外部函数接口和变量
- 禁止在`.h`中通过`extern`的方式使用外部函数接口
### 1.2 规则 通用规则

- 文件编码格式为 `UTF-8`,
- 换行符统一采用 `LF`
- 禁止使用 `Tab` 键, 首行缩进应采用 `4个空格` 替换 `Tab`
- 不要使用制表符，而是使用空格
- 始终在块的开头, 第一个可执行语句之前声明局部变量
### 1.3 规则 空格约束

- 在`+` `-` `*` `/` 等双目操作符前后必须空格
- 赋值操作符 `=` 比较操作符 `>` `>=` `<` `<=` 等前后必须空格
- `!` `~` `++` `--` `&`等单目操作符前后不加空格
- 每个逗号后使用一个空格
- `for`, `while`, `do`, `switch`, `if`等关键字与`(`之间必须空格
- `)`之前不能空格, `(`之后不能空格
- `for`, `while`, `do`, `switch`, `if`等关键字始终与`{`在同一行
- `)` 与 `{` 之间必须空格
- `;`之前不能空格
> **示例:**

```c
n = i + 1;      // 正确
i++             // 正确
if (a > b) ...  // 正确

a = i+1;        // 错误 "+" 左右两端应该加空格

func_name (5, 4);       // 正确
func_name (4 , 3);      // 错误

/* 正确 */
for (i = 0; i < 5; ++i) {
    ...
}

/* 错误 */
// "for" 之后应该有空格
// ";"   之前应该无空格
// "{"   之前应该有空格
for(i = 0 ; i < 5 ; ++i){
    ...
}

/* 错误 */
// "{"   不应该另起一行
for (i = 0; i < 5; ++i)
{
    ...
}
```
### 1.4 规则 语句块

- `else-if` `else` 语句必须与 `if`语句的`}` 在同一行
- 在`do-while`语句的情况下，`while`部分必须与`do`部分的右括号在同一行
- 如果 `while` `for` 等语句块为空时, 使用空的单行括号
- 不同语句块之间应采用空行隔开
> **示例:**

```c

while (*addr & (1 << 13)) {}      // 正确

/* 正确 */
if (c) {
    ...
} else {
    ...
}

/* 错误 */
if (c) {
    ...
}
else {
    ...
}

/* 正确 */
do {
    ...
} while (check());

/* 错误 */
do {
    ...
}
while (check());
```
### 1.5 规则 变量声明

- 每行只能声明一个变量
> **示例:**

```c
/* 正确 */
int a;
int b;
int c = 5;

/* 错误 */
int a, b;
int c, d = 0;
```
### 1.6 建议 `switch-case` 结构

- `switch` 语句中为每个 `case` 语句需要缩进
- `break` 单独占一行, 包含 `default` 语句
- 如果需要局部变量, 请使用大括号并将 `break` 语句放入其中将左大括号与 `case` 语句放在同一行
> **示例:**

```c
switch (a) {
    /* 正确 */
    case 0: {
        ...
        break;
    }

    /* 错误 */
    case 1:
    {
        ...
        break;
    }

    /* 错误 */
    case 2: {
        ...
    } break;
}
```

---

## 2 头文件
### 2.1 建议 通用规范

- 头文件是模块(Module)或单元(Unit)的对外接口。头文件中应放置对外部的声明，如对外提供的函数声明、宏定义、类型定义等。

---

## 3 命名规则
### 3.1 建议

- 函数命名, 变量命名, 文件命名要有描述性, 少用缩写, 采用通用的英文, 不能使用拼音
- 尽可能使用描述性的命名, 让人一看就大概知道这个是干什么的
- 一般只是用使用大家都能看懂的缩写
- 不要用只有项目开发者能理解的缩写
- 不要通过砍掉几个字母来缩写单词.
> **示例:**

```c
int price_count_reader;    // 正确 无缩写
int num_errors;            // 正确 "num" 是一个常见的写法
int num_dns_connections;   // 正确 人人都知道 "DNS" 是什么

int n;                     // 错误 毫无意义
int jiage;                 // 错误 使用拼音
int nerr;                  // 错误 含糊不清的缩写
int n_comp_conns;          // 错误 含糊不清的缩写
int wgc_connections;       // 错误 只有贵团队知道是什么意思
int pc_reader;             // 错误 "pc" 有太多可能的解释了
int cstmr_id;              // 错误 删减了若干字母
```
**注意** 一些特定的广为人知的缩写是允许的, 例如用 `i` 表示迭代变量
### 3.2 建议 文件命名

- 文件命名统一采用 `小写单词 + 下划线` 的形式, 但下划线不能加在开始或者结尾
> **示例:**

```c
my_useful_class.c       // 正确 采用下划线
myusefulclass.c         // 正确 不适用下划线
os_sem.c                // 正确

os-sem.c                // 错误 使用连字符"-"
os_sem_.c               // 错误 "_" 加在结尾
```
### 3.3 规则 函数命名

- 函数命名命名统一采用 `小写单词 + 下划线` 的形式
- 特殊函数下划线可以加在头或尾
> **示例:**

```c
/* 正确 */
int init_pipe()
{
    ...
}

/* 错误 不应该使用大写*/
int Init_Pipe()
{
    ...
}
```
### 3.4 规则 变量命名

- 变量和数据成员命名统一采用 `小写单词 + 下划线` 的形式, 但下划线不能加在开始或者结尾
- 全局变量采用 `g_` 作为前缀
- 静态局部变量使用 `s_` 作为前缀
> **示例:**

```c
int g_table_name;

int init_pipe()
{
    int mem_size;

}
```
### 3.5 规则 宏命名

- 对于数值或者字符串等常量的命名统一采用 `大写单词 + 下划线` 的形式, 但下划线不能加在开始或者结尾
- 除了头文件或编译开关等特殊标识定义，
- 宏定义不能使用下划线`_`开头和结尾
> **示例:**

```c
#define PI_ROUNDED  3.14    // 正确
#define _PI_ROUNDED 3.14    // 错误 使用"_"开头
```
### 3.6 规则 枚举 结构体 共用体命名

- 枚举、结构体 的命名应当采用`小写单词+下划线`的方式
- 枚举成员必须 `大写单词+下划线`的方式命名
- 结构体成员必须 `小写单词+下划线`的方式命名
- 当结构名字用 `typedef` 声明时不能包含`_t`基本名称, `typedef` 声明的别名后必须包含`_t`后缀
> **示例:**

```c
/* 正确 */
enum alternate_url_table_errors {
    OK = 0,
    OUT_OF_MEMORY = 1,
    MALFORMED_INPUT = 2,
};

/* 正确 */
struct struct_name {
    int a;
    int b;
}

/* 正确 */
typedef struct {
    int a;
    int b;
} struct_name_t;

/* 正确 */
typedef struct struct_name {
    int a;
    int b;
} struct_name_t;

/* 错误 结构头命名不能包含 _t 后缀*/
struct name_t {
    int a;
    int b;
};

/* 错误 参数必须全部大写 */
typedef enum {
   MY_ENUM_TESTA，
   my_enum_testb,
} my_enum_t;
```

---

## 4 函数
### 4.1 规则

- 对齐所有函数原型（具有相同/相似的功能）以获得更好的可读性

---

## 5 宏和预处理器指令
### 5.1 建议 括号

- 对于参数应该使用括号括起来
- 对于单个参数数字, 可以不使用括号
> **示例:**

```c
/* 正确 */
#define MIN(x, y)       ((x) < (y) ? (x) : (y))
#define SUM(x, y)       ((x) + (y))
#define PI_ROUNDED      3.14

/* 错误 */
#define MIN(x, y)       x < y ? x : y
#define SUM(x, y)       (x) + (y)
```
### 5.2 规则 宏定义

- 当宏使用多个语句时，使用`do-while (0)`语句保护它
> **示例:**

```c
/* 正确 */
#define XXX_YYY(...) do {   \
        ... \
        ... \
    } while (0)
```
### 5.3 规则 `#if` 语句

- 不要在`#if`语句内缩进子语句
> **示例:**

```c
/* 正确 */
#if defined(XYZ)
#if defined(ABC)
...
#endif /* defined(ABC) */
#else /* defined(XYZ) */
...
#endif /* !defined(XYZ) */

/* 错误 */
#if defined(XYZ)
    #if defined(ABC)
        ...
    #endif
#else
    ...
#endif
```

---

## 6 注释
#### 6.1 建议 注释风格

- 允许使用 `//` 和 `/* xxx */` 注释风格 ( `/*` 后面 和 `*/` 前面必须空格)
- 使用 `//` 后必须跟一个空格, 要求整体对齐看起来美观简洁
- 程序块要求使用 `/**/` 注释, 语句之后单行要求使用 `//` 注释
> **示例:**

```c
/* 正确 */
...         // 注释A
...         // 注释B
...         // 注释C
...         // 注释D

/* 正确 */
...         // 注释A
...         // 注释B
...........         // 注释C
...........         // 注释D

/* 错误 */
...         // 注释A
...         // 注释B
...         // 注释C
...         // 注释D
```
### 6.2 规则 文件注释

- 在每一个文件开头加入`版权公告`, `文件名`, `描述` 等信息
> **示例:**

```c
/**
 * @copyright Copyright (c) 2021..
 *
 * @file    cJSON.c
 * @brief   描述
 */
```
### 6.3 建议 函数注释

- 函数声明处的注释描述函数功能, 定义处的注释描述函数实现
### 6.4 规则 函数注释

- 函数注释包含 `描述` `参数` `返回` 等信息, 如果没有则不需要那一项
```c
/**
 * @brief   描述
 *
 * @param   string1     参数说明
 * @param   string2     参数说明
 * @return  bool
 */
```
### 6.5 建议 结构体、枚举、共用体注释

- 每个结构体、枚举、共用体的定义都要附带一份注释, 描述类的功能和用法, 除非它的功能相当明显
